<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('./partials/head') %>
  <title>HomePage</title>
</head>

<body class="bg-gray-100 font-sans">

  <%- include('./partials/nav') %>

  <main class="container py-4">
    <h1 style="font-family: 'Georgia', sans-serif; font-weight: 700; color:#5f1c9a;">
      All Blogs
    </h1>

    <% if (!blogs || blogs.length === 0) { %>
      <p>No blogs yet. <a href="/create">Create the first blog</a></p>

    <% } else { %>
      <div class="blog-list">

        <% blogs.forEach(function(blog) { %>

          <article class="card mb-3 p-3" style="border: 2px solid #6460da; background-color: #f0efff;">
            <div class="d-flex justify-content-between align-items-center">

              <!-- Blog Title -->
              <h2 class="m-0" style="color:#5f1c9a;">
                <%= blog.title %>
              </h2>

              <!-- Icons Section -->
              <div class="d-flex align-items-center">

                <!-- Edit -->
                <a href="/edit/<%= blog._id %>" class="mx-2" style="text-decoration:none;">
                  <i class="bi bi-pen fs-5" style="color:#6460da; cursor:pointer;"></i>
                </a>

                <!-- Delete (opens modal) -->
                <button
                  onclick="openDeleteModal('<%= blog._id %>')"
                  aria-label="Delete blog"
                  style="background:none; border:none; padding:0; margin:0; cursor:pointer;">
                  <i class="bi bi-trash3-fill fs-5" style="color:#e63946;"></i>
                </button>

              </div>

            </div>

            <p><small>Posted: <%= new Date(blog.createdAt).toLocaleString() %></small></p>

            <!-- Full content (no trimming) -->
            <p><%= blog.content %></p>

          </article>

        <% }); %>
      </div>
    <% } %>

  </main>

  <!-- Custom Delete Modal -->
  <div id="deleteModal" aria-hidden="true" style="
        display:none;
        position:fixed;
        inset:0;
        width:100%;
        height:100%;
        background:rgba(0,0,0,0.5);
        justify-content:center;
        align-items:center;
        z-index:9999;
    ">
    <div role="dialog" aria-modal="true" style="
          background:white;
          padding:24px;
          border-radius:10px;
          width:calc(100% - 40px);
          max-width:420px;
          text-align:center;
          box-shadow:0 10px 30px rgba(0,0,0,0.2);
      ">
      <h3 style="margin-bottom:12px;">Delete Blog</h3>
      <p style="margin-bottom:20px;">Are you sure you want to delete this blog?</p>

      <div style="display:flex; gap:12px; justify-content:center;">

        <button type="button" onclick="closeModal()" style="
              padding:8px 18px;
              border:none;
              border-radius:6px;
              background:#777;
              color:white;
              cursor:pointer;">
          Cancel
        </button>

        <form id="deleteForm" method="POST" style="margin:0;">
          <button type="submit" style="
                padding:8px 18px;
                border:none;
                border-radius:6px;
                background:#e63946;
                color:white;
                cursor:pointer;">
            Delete
          </button>
        </form>

      </div>
    </div>
  </div>

  <%- include('./partials/script') %>

  <!-- Modal JS -->
  <script>
    function openDeleteModal(id) {
      const form = document.getElementById("deleteForm");
      form.action = "/create/delete/" + id;

      const modal = document.getElementById("deleteModal");
      modal.style.display = "flex";
      modal.setAttribute("aria-hidden", "false");
    }

    function closeModal() {
      const modal = document.getElementById("deleteModal");
      modal.style.display = "none";
      modal.setAttribute("aria-hidden", "true");
    }

    // Close when clicking backdrop
    document.getElementById("deleteModal").addEventListener("click", function (e) {
      if (e.target === this) closeModal();
    });

    // Close when pressing Escape
    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") closeModal();
    });
  </script>

</body>

</html>
